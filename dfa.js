"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Input=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"val",value:function(){throw"Input#val() must be implemented by subclasses"}}]),t}(),CharInput=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.ch=t,n}return _inherits(e,Input),_createClass(e,[{key:"val",value:function(){return this.ch}}],[{key:"create",value:function(t){return t.split("").map(function(t){return new e(t)})}}]),e}(),Label=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"match",value:function(t){throw"Label#match(input) must be implemented by subclasses"}}]),t}(),CharLabel=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,Label),e}();CharLabel.Single=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.ch=t,n}return _inherits(e,CharLabel),_createClass(e,[{key:"match",value:function(t){return t.val()===this.ch}}]),e}(),CharLabel.Range=function(t){function e(t,n){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.first=t,r.end=n,r}return _inherits(e,CharLabel),_createClass(e,[{key:"match",value:function(t){return t.val()>=this.first&&t.val()<=this.end}}]),e}(),CharLabel.Include=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.chars=t,n}return _inherits(e,CharLabel),_createClass(e,[{key:"match",value:function(t){return this.chars.includes(t.val())}}]),e}(),CharLabel.Exclude=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.chars=t,n}return _inherits(e,CharLabel),_createClass(e,[{key:"match",value:function(t){return!this.chars.includes(t.val())}}]),e}(),CharLabel.Or=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.labels=Array.prototype.slice.call(arguments),t}return _inherits(e,CharLabel),_createClass(e,[{key:"match",value:function(t){return this.labels.some(function(e){return e.match(t)})}}]),e}();var Edge=function(){function t(e,n){_classCallCheck(this,t),this.label=e,this.dest=n}return _createClass(t,[{key:"tryTransition",value:function(t,e){return this.label.match(t,e)?this.dest:null}}]),t}(),State=function(){function t(e,n,r){_classCallCheck(this,t),this.num=e,this.edges=n||[],this.obj=void 0===r?null:r}return _createClass(t,[{key:"getAcceptedObject",value:function(){return this.obj}},{key:"isAcceptable",value:function(){return null!==this.obj}},{key:"isEdgeExists",value:function(){return this.edges.length>0}}]),t}(),DFA=function(){function t(){_classCallCheck(this,t),this.start=null,this.states={}}return _createClass(t,[{key:"addStartState",value:function(t){this.start=t,this.states[t.num]=t}},{key:"addState",value:function(t){this.states[t.num]=t}},{key:"getStateByNum",value:function(t){return this.states[t]}},{key:"startNewTransition",value:function(){if(null===this.start)throw"Start state isn't set";return new Transition(this)}}]),t}(),Transition=function(){function t(e){_classCallCheck(this,t),this.dfa=e,this.current=e.start,this.session={}}return _createClass(t,[{key:"transit",value:function(t){var e=this;if(null===this.current)throw"This transition has already failed due to illegal structure of the dfa";var n=this.current.edges.map(function(n){return n.tryTransition(t,e.session)}).find(function(t){return null!==t});if(!n)return!1;if(this.current=this.dfa.states[n],!this.current)throw"Destination state '"+n+"' is not found";return!0}},{key:"isAcceptable",value:function(){return this.current.isAcceptable()}},{key:"isEdgeExists",value:function(){return this.current.isEdgeExists()}},{key:"getAcceptedObject",value:function(){if(!this.isAcceptable())throw"current state is not acceptable";return this.current.getAcceptedObject()}}]),t}(),CharInputSequence=function(){function t(e){_classCallCheck(this,t),this.str=e,this.nextLexis="",this.forwardingPointer=0,this.enableUnget=!1}return _createClass(t,[{key:"get",value:function(){if(!this.hasNext())return null;var t=this.str.charAt(this.forwardingPointer++);return this.enableUnget=!0,this.nextLexis+=t,new CharInput(t)}},{key:"unget",value:function(){if(!this.enableUnget)throw"Call get before unget";this.enableUnget=!1,this.forwardingPointer--,this.nextLexis=this.nextLexis.slice(0,-1)}},{key:"findLexis",value:function(){this.enableUnget=!1;var t=this.nextLexis;return this.nextLexis="",t}},{key:"hasNext",value:function(){return this.forwardingPointer<this.str.length}}]),t}(),Token=function t(e,n){_classCallCheck(this,t),this.lexis=e,this.obj=n},Parser=function(){function t(e,n){_classCallCheck(this,t),this.dfa=e,this.input=n,this._next=null}return _createClass(t,[{key:"next",value:function(){if(this.hasNext()){var t=this._next;return this._next=null,t}return null}},{key:"hasNext",value:function(){if(null!==this._next)return!0;if(!this.input.hasNext())return!1;for(var t=this.dfa.startNewTransition(),e=void 0;null!==(e=this.input.get());)if(!t.transit(e)){if(t.isAcceptable()){this.input.unget();var n=this.input.findLexis();return this._next=new Token(n,t.getAcceptedObject()),!0}throw"Parse error. near '"+this.input.findLexis()+"'"}var r=this.input.findLexis();if(!t.isAcceptable())throw"Parse error. near '"+r+"'";return this._next=new Token(r,t.getAcceptedObject()),!0}}]),t}();module.exports={Input:Input,CharInput:CharInput,Label:Label,CharLabel:CharLabel,Edge:Edge,State:State,DFA:DFA,Transition:Transition,CharInputSequence:CharInputSequence,Token:Token,Parser:Parser};